<!DOCTYPE html>
<head>

    <!-- Add code here -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    
    <style>
        .mainContainer{
          padding: 25px;
        }
        body {
            background-color: rgb(236, 236, 236);
        }
        .table th {
          text-align: center;   
        }
    </style>

</head>
<body>
    <!-- seperate from the sides -->
    <div class="mainContainer">

        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                  <a class="nav-link" href="main.html"> Home </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="favourite.html"> Favourites <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#"> Subscribe </a>
                </li>
              </ul>
              <i class="fas fa-user mr-2"></i> <span class="navbar-text" id="userNamePlaceholder"> </span>
            </div>
        </nav>
    
        </br>
    
    
        <form>
          <table class="table table-borderless table-hover" id="displayTable">
            <thead class="thead-dark">
              <tr >
                <th scope="col" class="text-center mx-auto"> Vessel </th>
                <th scope="col"> Incoming Voyage Number </th>
                <th scope="col"> Outgoing voyage number </th>
                <th scope="col"> Berthing Time </th>
                <th scope="col"> Departure time </th>
                <th scope="col"> Berth Number </th>
                <th scope="col"> Change Count </th>
                <th scope="col"> Degree Change </th>
                <th scope="col"> First Berth Time </th>
                <th scope="col"> Status </th>
                <th scope="col"> Remove </th>
              </tr>
            </thead>
            <tbody >
              <!-- Table Body -->
            </tbody>
          </table>
        </form>
    
      </div>


      <script>
        // Document.ready function 
        document.addEventListener("DOMContentLoaded", function(event) { 
          
          if(sessionStorage.getItem("email") != null){
              var checkEmail = sessionStorage.getItem("email");
              console.log(checkEmail);
              //document.getElementById("userNamePlaceholder").innerHTML = email;
          } else {
            console.log("no email") // Login page will sent over email via session
            //var checkEmail = "test@gmail5.com";
          }

          var request = new XMLHttpRequest();
          request.onreadystatechange = function(){
            if (this.readyState == 4 && this.status == 200) {
              dataObj = JSON.parse(this.responseText);
              var email = dataObj["email"];
              var favouritesVessels = dataObj["favouritedVessels"];
              document.getElementById("userNamePlaceholder").innerHTML = email;
              getFavouritedVessels(favouritesVessels,email);
            } else {
              // to display error code
            }
          }
          request.open("GET", "http://localhost:8080/getAccountByEmail?email="+checkEmail, true);
          request.send();
        });


        function getFavouritedVessels(favouritesVessels,email){
          var tableRef = document.getElementById('displayTable').getElementsByTagName('tbody')[0];
          for(var ship of favouritesVessels){
            var newRow = tableRef.insertRow(tableRef.rows.length);
  
            var vessl_id  = ship["vesselId"];

            var cell01  = newRow.insertCell(0);
            var input01  = document.createTextNode(ship["abbrVslM"])
            cell01.appendChild(input01);

            var cell02  = newRow.insertCell(1);
            var input02  = document.createTextNode(ship["inVoyN"])
            cell02.appendChild(input02);

            var cell03  = newRow.insertCell(2);
            var input03  = document.createTextNode(ship["outVoyN"])
            cell03.appendChild(input03);

            var cell04  = newRow.insertCell(3);
            var input04  = document.createTextNode(ship["btrDt"])
            cell04.appendChild(input04);

            var cell05  = newRow.insertCell(4);
            var input05  = document.createTextNode(ship["etdDt"])
            cell05.appendChild(input05);

            var cell06  = newRow.insertCell(5);
            var input06  = document.createTextNode(ship["berthN"])
            cell06.appendChild(input06);

            var cell07  = newRow.insertCell(6);
            var input07  = document.createTextNode(ship["changeCount"])
            cell07.appendChild(input07);

            var cell08  = newRow.insertCell(7);
            var input08  = document.createTextNode(ship["degreeChange"])
            cell08.appendChild(input08);

            var cell09  = newRow.insertCell(8);
            var input09  = document.createTextNode(ship["firstBerthTime"])
            cell09.appendChild(input09);

            var cell10  = newRow.insertCell(9);
            var input10  = document.createTextNode(ship["status"])
            cell10.appendChild(input10);

            var cell11  = newRow.insertCell(10);
            var removeBtn  = document.createElement("BUTTON")
            removeBtn.setAttribute("type", "button")
            removeBtn.setAttribute("id", "addBtn-"+ship["vesselId"]+"-"+ship["abbrVslM"]+"-"+ship["inVoyN"]+"-"+ship["outVoyN"])
            removeBtn.setAttribute("class", "btn btn-danger")
            removeBtn.setAttribute("onclick", "removeFromFavourites('"+ email +"','"+ ship["abbrVslM"] +"','"+ ship["inVoyN"] +"','"+ship["outVoyN"]+"')")
            removeBtn.innerHTML = "Remove";
            cell11.appendChild(removeBtn);
          }
        }

    function removeFromFavourites( email, vesselName, incomingVoyage, outcomingVoyage){
    console.log("remove to Favourites");

    // Delete from Favourites
    var request = new XMLHttpRequest();
    request.onreadystatechange = function() {
      if(this.readyState == 4 && this.status == 200){
        console.log("Success :)");
        location.reload();
      } else {
        // To display error code if need.
      }
    }
    var data = "http://localhost:8080/deleteFavourite" + "?vesselShortName=" + vesselName + "&incoming=" + incomingVoyage + "&email=" + email
    request.open("DELETE", data, true);
    request.setRequestHeader("Content-type", "application/json");
    request.send();
  }


      </script>
</body>